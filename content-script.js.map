{
  "version": 3,
  "sources": ["../src/shared/messages.ts", "../src/content/index.ts"],
  "sourcesContent": ["export const MessageType = {\n  OptimizePrompt: 'OPTIMIZE_PROMPT'\n} as const;\n\nexport type MessageKind = typeof MessageType[keyof typeof MessageType];\n\nexport type OptimizePromptRequest = {\n  type: typeof MessageType.OptimizePrompt;\n  payload: {\n    originalPrompt: string;\n    styleId?: string;\n    source?: 'content-script' | 'popup';\n    pageHost?: string;\n  };\n};\n\nexport type OptimizePromptResponse = {\n  success: boolean;\n  optimizedPrompt?: string;\n  error?: string;\n};\n\nexport function isOptimizePromptRequest(message: unknown): message is OptimizePromptRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as OptimizePromptRequest;\n  return typed.type === MessageType.OptimizePrompt && Boolean(typed.payload?.originalPrompt);\n}\n", "import { MessageType, OptimizePromptResponse } from '../shared/messages';\n\nconst BUTTON_CLASS = 'prompt-enhancer-btn';\nconst BUTTON_TEXT = '\u4F18\u5316\u6307\u4EE4';\n\nfunction selectorMap(host: string): string[] {\n  if (host.includes('chatgpt.com') || host.includes('chat.openai.com')) {\n    return ['div[role=\"textbox\"]', 'textarea[placeholder*=\"Message\"]'];\n  }\n  if (host.includes('manus.im')) {\n    return ['div[contenteditable=\"true\"][role=\"textbox\"]', 'textarea', 'div[role=\"textbox\"]'];\n  }\n  if (host.includes('gemini.google.com')) {\n    return ['textarea', 'div[contenteditable=\"true\"]'];\n  }\n  return ['div[role=\"textbox\"]', 'textarea', 'input[type=\"text\"]'];\n}\n\nfunction findPromptInput(): HTMLElement | null {\n  const selectors = selectorMap(window.location.host);\n  for (const selector of selectors) {\n    const el = document.querySelector<HTMLElement>(selector);\n    if (el) return el;\n  }\n  return null;\n}\n\nfunction getPromptValue(el: HTMLElement): string {\n  if (el instanceof HTMLTextAreaElement || el instanceof HTMLInputElement) {\n    return el.value || '';\n  }\n  return el.textContent || '';\n}\n\nfunction setPromptValue(el: HTMLElement, value: string) {\n  if (el instanceof HTMLTextAreaElement || el instanceof HTMLInputElement) {\n    el.value = value;\n    el.dispatchEvent(new Event('input', { bubbles: true }));\n    return;\n  }\n  el.textContent = value;\n  el.dispatchEvent(new Event('input', { bubbles: true }));\n}\n\nfunction insertButton(target: HTMLElement) {\n  if (document.querySelector(`.${BUTTON_CLASS}`)) return;\n\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.textContent = BUTTON_TEXT;\n  button.className = BUTTON_CLASS;\n  styleButton(button);\n\n  button.addEventListener('click', () => handleOptimize(button, target));\n\n  const parent = target.parentElement;\n  if (parent) {\n    parent.appendChild(button);\n  } else {\n    target.insertAdjacentElement('afterend', button);\n  }\n}\n\nfunction styleButton(button: HTMLButtonElement) {\n  button.style.marginLeft = '8px';\n  button.style.padding = '6px 12px';\n  button.style.borderRadius = '999px';\n  button.style.border = '1px solid rgba(0,0,0,0.1)';\n  button.style.background = '#f5f5f5';\n  button.style.color = '#111';\n  button.style.cursor = 'pointer';\n  button.style.fontSize = '13px';\n  button.style.display = 'inline-flex';\n  button.style.alignItems = 'center';\n  button.style.gap = '6px';\n}\n\nasync function handleOptimize(button: HTMLButtonElement, target: HTMLElement) {\n  const originalPrompt = getPromptValue(target).trim();\n  if (!originalPrompt) {\n    button.textContent = '\u8BF7\u8F93\u5165\u5185\u5BB9';\n    setTimeout(() => (button.textContent = BUTTON_TEXT), 1200);\n    return;\n  }\n\n  setLoading(button, true);\n  try {\n    const response = (await chrome.runtime.sendMessage({\n      type: MessageType.OptimizePrompt,\n      payload: { originalPrompt, source: 'content-script', pageHost: window.location.host }\n    })) as OptimizePromptResponse;\n\n    if (!response?.success || !response.optimizedPrompt) {\n      const msg = response?.error || '\u4F18\u5316\u5931\u8D25';\n      button.textContent = msg;\n      setTimeout(() => (button.textContent = BUTTON_TEXT), 1400);\n      return;\n    }\n\n    setPromptValue(target, response.optimizedPrompt);\n  } catch (error) {\n    console.error('Optimize failed', error);\n    button.textContent = '\u8BF7\u6C42\u9519\u8BEF';\n    setTimeout(() => (button.textContent = BUTTON_TEXT), 1400);\n  } finally {\n    setLoading(button, false);\n  }\n}\n\nfunction setLoading(button: HTMLButtonElement, loading: boolean) {\n  button.disabled = loading;\n  button.textContent = loading ? '\u4F18\u5316\u4E2D\u2026' : BUTTON_TEXT;\n}\n\nfunction mount() {\n  const input = findPromptInput();\n  if (input) {\n    insertButton(input);\n    return;\n  }\n\n  const observer = new MutationObserver(() => {\n    const found = findPromptInput();\n    if (found) {\n      insertButton(found);\n      observer.disconnect();\n    }\n  });\n  observer.observe(document.body, { childList: true, subtree: true });\n}\n\nif (document.readyState === 'complete' || document.readyState === 'interactive') {\n  mount();\n} else {\n  window.addEventListener('DOMContentLoaded', mount);\n}\n"],
  "mappings": "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",
  "names": []
}
