{
  "version": 3,
  "sources": ["../src/shared/messages.ts", "../src/content/button-styles.ts", "../src/content/index.ts"],
  "sourcesContent": ["export const MessageType = {\n  OptimizePrompt: 'OPTIMIZE_PROMPT',\n  TriggerOptimize: 'TRIGGER_OPTIMIZE'\n} as const;\n\nexport type MessageKind = typeof MessageType[keyof typeof MessageType];\n\nexport type OptimizePromptRequest = {\n  type: typeof MessageType.OptimizePrompt;\n  payload: {\n    originalPrompt: string;\n    styleId?: string;\n    source?: 'content-script' | 'popup';\n    pageHost?: string;\n  };\n};\n\nexport type OptimizePromptResponse = {\n  success: boolean;\n  optimizedPrompt?: string;\n  error?: string;\n};\n\nexport type TriggerOptimizeMessage = {\n  type: typeof MessageType.TriggerOptimize;\n};\n\nexport function isOptimizePromptRequest(message: unknown): message is OptimizePromptRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as OptimizePromptRequest;\n  return typed.type === MessageType.OptimizePrompt && Boolean(typed.payload?.originalPrompt);\n}\n\nexport function isTriggerOptimizeMessage(message: unknown): message is TriggerOptimizeMessage {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as TriggerOptimizeMessage;\n  return typed.type === MessageType.TriggerOptimize;\n}\n", "/**\n * Button styling utility module for ChatGPT inline button\n * Most styles are now in content-script.css, this only handles dynamic styling\n */\n\n/**\n * Detects if ChatGPT is currently in dark mode\n * @returns true if dark mode is active, false otherwise\n */\nexport function isDarkMode(): boolean {\n  // ChatGPT uses Tailwind dark mode with 'dark' class on <html>\n  return document.documentElement.classList.contains('dark');\n}\n\n/**\n * Applies minimal dynamic button styles (most styles are in CSS now)\n * @param button - The button element to style\n */\nexport function applyButtonStyles(button: HTMLButtonElement): void {\n  // Most styles are now in content-script.css\n  // This function is kept for backwards compatibility and future dynamic styling needs\n  console.log('[Prompt Optimizer] Button styles applied via CSS');\n}\n\n/**\n * Sets up a MutationObserver to watch for theme changes\n * This is no longer needed as CSS handles dark mode automatically via html.dark selector\n * Kept for compatibility\n * @param button - The button element to update on theme change\n * @returns MutationObserver instance (can be disconnected if needed)\n */\nexport function observeThemeChanges(button: HTMLButtonElement): MutationObserver {\n  const observer = new MutationObserver(() => {\n    const isDark = isDarkMode();\n    console.log('[Prompt Optimizer] Theme changed to:', isDark ? 'dark' : 'light');\n  });\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['class']\n  });\n\n  return observer;\n}\n", "import { MessageType, OptimizePromptResponse, isTriggerOptimizeMessage } from '../shared/messages';\nimport { applyButtonStyles, observeThemeChanges } from './button-styles';\n\nconst BUTTON_CLASS = 'prompt-enhancer-btn';\nconst BUTTON_TEXT = '\u4F18\u5316\u6307\u4EE4';\n\nconsole.log('[Prompt Optimizer] Content script loaded on:', window.location.href);\n\nfunction selectorMap(host: string): string[] {\n  if (host.includes('chatgpt.com') || host.includes('chat.openai.com')) {\n    return ['div[role=\"textbox\"]', '#prompt-textarea', 'textarea[placeholder*=\"Message\"]'];\n  }\n  if (host.includes('manus.im')) {\n    return ['div[contenteditable=\"true\"][role=\"textbox\"]', 'textarea', 'div[role=\"textbox\"]'];\n  }\n  if (host.includes('gemini.google.com')) {\n    return ['textarea', 'div[contenteditable=\"true\"]'];\n  }\n  return ['div[role=\"textbox\"]', 'textarea', 'input[type=\"text\"]'];\n}\n\nfunction findPromptInput(): HTMLElement | null {\n  const selectors = selectorMap(window.location.host);\n  console.log('[Prompt Optimizer] Trying selectors:', selectors);\n\n  for (const selector of selectors) {\n    const el = document.querySelector<HTMLElement>(selector);\n    if (el) {\n      console.log('[Prompt Optimizer] \u2705 Found input element:', selector, el);\n      return el;\n    }\n  }\n\n  console.warn('[Prompt Optimizer] \u274C Could not find input element');\n  return null;\n}\n\nfunction getPromptValue(el: HTMLElement): string {\n  if (el instanceof HTMLTextAreaElement || el instanceof HTMLInputElement) {\n    return el.value || '';\n  }\n  return el.textContent || '';\n}\n\nfunction setPromptValue(el: HTMLElement, value: string) {\n  if (el instanceof HTMLTextAreaElement || el instanceof HTMLInputElement) {\n    el.value = value;\n    el.dispatchEvent(new Event('input', { bubbles: true }));\n    return;\n  }\n  el.textContent = value;\n  el.dispatchEvent(new Event('input', { bubbles: true }));\n}\n\nfunction insertButton(target: HTMLElement) {\n  if (document.querySelector(`.${BUTTON_CLASS}`)) {\n    console.log('[Prompt Optimizer] Button already exists');\n    return;\n  }\n\n  console.log('[Prompt Optimizer] Creating button...');\n\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.textContent = BUTTON_TEXT;\n  button.className = BUTTON_CLASS;\n\n  // Apply styles (CSS handles most styling now)\n  applyButtonStyles(button);\n  observeThemeChanges(button);\n\n  button.addEventListener('click', () => handleOptimize(button, target));\n\n  console.log('[Prompt Optimizer] Trying insertion strategies...');\n\n  // Strategy 1: Try to anchor next to ChatGPT \"+\" button\n  const plusButtonEl = document.querySelector('[data-testid=\"composer-plus-btn\"]');\n  console.log('[Prompt Optimizer] Strategy 1 - Plus button found:', plusButtonEl);\n\n  if (plusButtonEl) {\n    const plusContainer = plusButtonEl.parentElement;\n    console.log('[Prompt Optimizer] Plus button container:', plusContainer);\n\n    if (plusContainer) {\n      plusContainer.appendChild(button);\n      console.log('[Prompt Optimizer] \u2705 Button inserted via Strategy 1 (next to + button)');\n      return;\n    }\n  }\n\n  // Strategy 2: Try grid-area:leading container\n  const leadingArea = document.querySelector('[class*=\"grid-area:leading\"]');\n  console.log('[Prompt Optimizer] Strategy 2 - Leading area:', leadingArea);\n\n  if (leadingArea) {\n    const plusButtonSpan = leadingArea.querySelector('span.flex');\n    console.log('[Prompt Optimizer] Plus button span:', plusButtonSpan);\n\n    if (plusButtonSpan) {\n      plusButtonSpan.appendChild(button);\n      console.log('[Prompt Optimizer] \u2705 Button inserted via Strategy 2 (grid-area:leading)');\n      return;\n    }\n  }\n\n  // Strategy 3: Insert before target's parent\n  const parent = target.parentElement;\n  console.log('[Prompt Optimizer] Strategy 3 - Target parent:', parent);\n\n  if (parent) {\n    parent.insertBefore(button, target);\n    console.log('[Prompt Optimizer] \u2705 Button inserted via Strategy 3 (before target)');\n    return;\n  }\n\n  // Strategy 4: Last resort\n  target.insertAdjacentElement('beforebegin', button);\n  console.log('[Prompt Optimizer] \u2705 Button inserted via Strategy 4 (insertAdjacentElement)');\n}\n\nasync function handleOptimize(button: HTMLButtonElement, target: HTMLElement) {\n  console.log('[Prompt Optimizer] Optimize triggered');\n\n  const originalPrompt = getPromptValue(target).trim();\n  if (!originalPrompt) {\n    console.warn('[Prompt Optimizer] Empty prompt');\n    button.textContent = '\u8BF7\u8F93\u5165\u5185\u5BB9';\n    setTimeout(() => (button.textContent = BUTTON_TEXT), 1200);\n    return;\n  }\n\n  console.log('[Prompt Optimizer] Original prompt:', originalPrompt.substring(0, 50) + '...');\n\n  setLoading(button, true);\n  try {\n    console.log('[Prompt Optimizer] Sending request to background...');\n    const response = (await chrome.runtime.sendMessage({\n      type: MessageType.OptimizePrompt,\n      payload: { originalPrompt, source: 'content-script', pageHost: window.location.host }\n    })) as OptimizePromptResponse;\n\n    console.log('[Prompt Optimizer] Response:', response);\n\n    if (!response?.success || !response.optimizedPrompt) {\n      const msg = response?.error || '\u4F18\u5316\u5931\u8D25';\n      console.error('[Prompt Optimizer] Failed:', msg);\n      button.textContent = msg;\n      setTimeout(() => (button.textContent = BUTTON_TEXT), 1400);\n      return;\n    }\n\n    console.log('[Prompt Optimizer] \u2705 Success, updating prompt');\n    setPromptValue(target, response.optimizedPrompt);\n  } catch (error) {\n    console.error('[Prompt Optimizer] Error:', error);\n    button.textContent = '\u8BF7\u6C42\u9519\u8BEF';\n    setTimeout(() => (button.textContent = BUTTON_TEXT), 1400);\n  } finally {\n    setLoading(button, false);\n  }\n}\n\nfunction setLoading(button: HTMLButtonElement, loading: boolean) {\n  button.disabled = loading;\n  button.textContent = loading ? '\u4F18\u5316\u4E2D\u2026' : BUTTON_TEXT;\n  if (loading) {\n    button.classList.add('loading');\n  } else {\n    button.classList.remove('loading');\n  }\n}\n\nfunction mount() {\n  console.log('[Prompt Optimizer] mount() called');\n\n  // Host gating\n  const host = window.location.host;\n  const supportedHosts = ['chatgpt.com', 'chat.openai.com'];\n  const isSupported = supportedHosts.some(h => host.includes(h));\n\n  if (!isSupported) {\n    console.log('[Prompt Optimizer] Unsupported host:', host);\n    return;\n  }\n\n  console.log('[Prompt Optimizer] \u2705 Supported host:', host);\n\n  // Try to find input immediately\n  const input = findPromptInput();\n  if (input) {\n    console.log('[Prompt Optimizer] Input found immediately');\n    insertButton(input);\n    return;\n  }\n\n  // Use MutationObserver if not found\n  console.log('[Prompt Optimizer] Setting up MutationObserver...');\n\n  let attempts = 0;\n  const maxAttempts = 100;\n\n  const observer = new MutationObserver(() => {\n    attempts++;\n    const found = findPromptInput();\n\n    if (found) {\n      console.log('[Prompt Optimizer] \u2705 Input found via observer (attempt', attempts, ')');\n      insertButton(found);\n      observer.disconnect();\n    } else if (attempts >= maxAttempts) {\n      console.error('[Prompt Optimizer] \u274C Failed after', maxAttempts, 'attempts');\n      observer.disconnect();\n    }\n  });\n\n  observer.observe(document.body, { childList: true, subtree: true });\n}\n\n// Initialize on page load\nif (document.readyState === 'complete' || document.readyState === 'interactive') {\n  console.log('[Prompt Optimizer] Document ready, mounting...');\n  mount();\n} else {\n  console.log('[Prompt Optimizer] Waiting for DOMContentLoaded...');\n  window.addEventListener('DOMContentLoaded', () => {\n    console.log('[Prompt Optimizer] DOMContentLoaded fired');\n    mount();\n  });\n}\n\n// Delayed retry for SPAs\nsetTimeout(() => {\n  console.log('[Prompt Optimizer] Delayed mount attempt (2s)');\n  mount();\n}, 2000);\n\n// Handle keyboard shortcut\nchrome.runtime.onMessage.addListener((message) => {\n  if (isTriggerOptimizeMessage(message)) {\n    console.log('[Prompt Optimizer] Keyboard shortcut triggered');\n    const button = document.querySelector<HTMLButtonElement>(`.${BUTTON_CLASS}`);\n    const target = findPromptInput();\n\n    if (button && target) {\n      handleOptimize(button, target);\n    } else {\n      console.warn('[Prompt Optimizer] Cannot handle shortcut - button or input missing');\n    }\n  }\n});\n\nconsole.log('[Prompt Optimizer] Content script initialized');\n"],
  "mappings": "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",
  "names": []
}
