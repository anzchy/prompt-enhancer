{
  "version": 3,
  "sources": ["../src/shared/messages.ts", "../src/content/button-styles.ts", "../src/content/index.ts"],
  "sourcesContent": ["export const MessageType = {\n  OptimizePrompt: 'OPTIMIZE_PROMPT',\n  TriggerOptimize: 'TRIGGER_OPTIMIZE'\n} as const;\n\nexport type MessageKind = typeof MessageType[keyof typeof MessageType];\n\nexport type OptimizePromptRequest = {\n  type: typeof MessageType.OptimizePrompt;\n  payload: {\n    originalPrompt: string;\n    styleId?: string;\n    source?: 'content-script' | 'popup';\n    pageHost?: string;\n  };\n};\n\nexport type OptimizePromptResponse = {\n  success: boolean;\n  optimizedPrompt?: string;\n  error?: string;\n};\n\nexport type TriggerOptimizeMessage = {\n  type: typeof MessageType.TriggerOptimize;\n};\n\nexport function isOptimizePromptRequest(message: unknown): message is OptimizePromptRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as OptimizePromptRequest;\n  return typed.type === MessageType.OptimizePrompt && Boolean(typed.payload?.originalPrompt);\n}\n\nexport function isTriggerOptimizeMessage(message: unknown): message is TriggerOptimizeMessage {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as TriggerOptimizeMessage;\n  return typed.type === MessageType.TriggerOptimize;\n}\n", "/**\n * Button styling utility module for ChatGPT inline button\n * Handles dark mode detection and styling application\n */\n\n/**\n * Detects if ChatGPT is currently in dark mode\n * @returns true if dark mode is active, false otherwise\n */\nexport function isDarkMode(): boolean {\n  // ChatGPT uses Tailwind dark mode with 'dark' class on <html>\n  return document.documentElement.classList.contains('dark');\n}\n\n/**\n * Applies button styles with dark mode support\n * Matches ChatGPT's voice button pattern (h-9, rounded-full, black/white theme)\n * @param button - The button element to style\n */\nexport function applyButtonStyles(button: HTMLButtonElement): void {\n  const isDark = isDarkMode();\n\n  // Base layout (pill-style matching voice button)\n  button.style.height = '36px'; // h-9\n  button.style.padding = '0 16px';\n  button.style.display = 'flex';\n  button.style.alignItems = 'center';\n  button.style.justifyContent = 'center';\n  button.style.borderRadius = '9999px'; // rounded-full\n  button.style.border = 'none';\n  button.style.cursor = 'pointer';\n  button.style.fontSize = '14px';\n  button.style.fontWeight = '500';\n  button.style.transition = 'opacity 0.2s';\n  button.style.whiteSpace = 'nowrap';\n\n  // Dark mode color flip (matches ChatGPT voice button)\n  button.style.background = isDark ? '#ffffff' : '#000000';\n  button.style.color = isDark ? '#000000' : '#ffffff';\n\n  // Hover state (via CSS-in-JS approximation)\n  button.addEventListener('mouseenter', () => {\n    if (!button.disabled) {\n      button.style.opacity = '0.7';\n    }\n  });\n  button.addEventListener('mouseleave', () => {\n    button.style.opacity = '1';\n  });\n\n  // Disabled state styling\n  if (button.disabled) {\n    button.style.opacity = '0.5';\n    button.style.cursor = 'not-allowed';\n  }\n}\n\n/**\n * Sets up a MutationObserver to watch for theme changes\n * Automatically re-styles button when ChatGPT theme toggles\n * @param button - The button element to update on theme change\n * @returns MutationObserver instance (can be disconnected if needed)\n */\nexport function observeThemeChanges(button: HTMLButtonElement): MutationObserver {\n  const observer = new MutationObserver(() => {\n    const isDark = isDarkMode();\n    // Only update colors, preserve other styles\n    button.style.background = isDark ? '#ffffff' : '#000000';\n    button.style.color = isDark ? '#000000' : '#ffffff';\n  });\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['class']\n  });\n\n  return observer;\n}\n", "import { MessageType, OptimizePromptResponse, isTriggerOptimizeMessage } from '../shared/messages';\nimport { applyButtonStyles, observeThemeChanges } from './button-styles';\n\nconst BUTTON_CLASS = 'prompt-enhancer-btn';\nconst BUTTON_TEXT = '\u4F18\u5316\u6307\u4EE4';\n\nfunction selectorMap(host: string): string[] {\n  if (host.includes('chatgpt.com') || host.includes('chat.openai.com')) {\n    return ['div[role=\"textbox\"]', 'textarea[placeholder*=\"Message\"]'];\n  }\n  if (host.includes('manus.im')) {\n    return ['div[contenteditable=\"true\"][role=\"textbox\"]', 'textarea', 'div[role=\"textbox\"]'];\n  }\n  if (host.includes('gemini.google.com')) {\n    return ['textarea', 'div[contenteditable=\"true\"]'];\n  }\n  return ['div[role=\"textbox\"]', 'textarea', 'input[type=\"text\"]'];\n}\n\nfunction findPromptInput(): HTMLElement | null {\n  const selectors = selectorMap(window.location.host);\n  for (const selector of selectors) {\n    const el = document.querySelector<HTMLElement>(selector);\n    if (el) return el;\n  }\n  return null;\n}\n\nfunction getPromptValue(el: HTMLElement): string {\n  if (el instanceof HTMLTextAreaElement || el instanceof HTMLInputElement) {\n    return el.value || '';\n  }\n  return el.textContent || '';\n}\n\nfunction setPromptValue(el: HTMLElement, value: string) {\n  if (el instanceof HTMLTextAreaElement || el instanceof HTMLInputElement) {\n    el.value = value;\n    el.dispatchEvent(new Event('input', { bubbles: true }));\n    return;\n  }\n  el.textContent = value;\n  el.dispatchEvent(new Event('input', { bubbles: true }));\n}\n\nfunction insertButton(target: HTMLElement) {\n  if (document.querySelector(`.${BUTTON_CLASS}`)) return;\n\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.textContent = BUTTON_TEXT;\n  button.className = BUTTON_CLASS;\n\n  // Apply modern button styles with dark mode support (T012)\n  applyButtonStyles(button);\n  observeThemeChanges(button);\n\n  button.addEventListener('click', () => handleOptimize(button, target));\n\n  // T009, T010: Primary insertion strategy - find [grid-area:leading] container\n  const leadingArea = document.querySelector('[class*=\"grid-area:leading\"]');\n  const plusButtonSpan = leadingArea?.querySelector('span.flex');\n\n  if (plusButtonSpan) {\n    // Insert into same container as \"+\" button with spacing\n    button.style.marginLeft = '8px';\n    plusButtonSpan.appendChild(button);\n    return;\n  }\n\n  // T011: Fallback insertion strategy (if grid-area not found)\n  const parent = target.parentElement;\n  if (parent) {\n    parent.insertBefore(button, target);\n  } else {\n    target.insertAdjacentElement('beforebegin', button);\n  }\n}\n\nasync function handleOptimize(button: HTMLButtonElement, target: HTMLElement) {\n  const originalPrompt = getPromptValue(target).trim();\n  if (!originalPrompt) {\n    button.textContent = '\u8BF7\u8F93\u5165\u5185\u5BB9';\n    setTimeout(() => (button.textContent = BUTTON_TEXT), 1200);\n    return;\n  }\n\n  setLoading(button, true);\n  try {\n    const response = (await chrome.runtime.sendMessage({\n      type: MessageType.OptimizePrompt,\n      payload: { originalPrompt, source: 'content-script', pageHost: window.location.host }\n    })) as OptimizePromptResponse;\n\n    if (!response?.success || !response.optimizedPrompt) {\n      const msg = response?.error || '\u4F18\u5316\u5931\u8D25';\n      button.textContent = msg;\n      setTimeout(() => (button.textContent = BUTTON_TEXT), 1400);\n      return;\n    }\n\n    setPromptValue(target, response.optimizedPrompt);\n  } catch (error) {\n    console.error('Optimize failed', error);\n    button.textContent = '\u8BF7\u6C42\u9519\u8BEF';\n    setTimeout(() => (button.textContent = BUTTON_TEXT), 1400);\n  } finally {\n    setLoading(button, false);\n  }\n}\n\nfunction setLoading(button: HTMLButtonElement, loading: boolean) {\n  button.disabled = loading;\n  button.textContent = loading ? '\u4F18\u5316\u4E2D\u2026' : BUTTON_TEXT;\n}\n\nfunction mount() {\n  // T016: Host gating - only inject on supported URLs\n  const host = window.location.host;\n  const supportedHosts = ['chatgpt.com', 'chat.openai.com'];\n  const isSupported = supportedHosts.some(h => host.includes(h));\n\n  if (!isSupported) {\n    console.log('[Prompt Optimizer] Skipping button injection - unsupported host:', host);\n    return;\n  }\n\n  const input = findPromptInput();\n  if (input) {\n    insertButton(input);\n    return;\n  }\n\n  const observer = new MutationObserver(() => {\n    const found = findPromptInput();\n    if (found) {\n      insertButton(found);\n      observer.disconnect();\n    }\n  });\n  observer.observe(document.body, { childList: true, subtree: true });\n}\n\nif (document.readyState === 'complete' || document.readyState === 'interactive') {\n  mount();\n} else {\n  window.addEventListener('DOMContentLoaded', mount);\n}\n\n// T013, T014: Handle keyboard shortcut message from background\nchrome.runtime.onMessage.addListener((message) => {\n  if (isTriggerOptimizeMessage(message)) {\n    const button = document.querySelector<HTMLButtonElement>(`.${BUTTON_CLASS}`);\n    const target = findPromptInput();\n\n    if (button && target) {\n      handleOptimize(button, target);\n    }\n  }\n});\n"],
  "mappings": "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",
  "names": []
}
