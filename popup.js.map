{
  "version": 3,
  "sources": ["../src/shared/messages.ts", "../src/popup/index.ts"],
  "sourcesContent": ["import type { PromptTemplate, ExportedTemplates } from './templates';\n\nexport const MessageType = {\n  OptimizePrompt: 'OPTIMIZE_PROMPT',\n  TriggerOptimize: 'TRIGGER_OPTIMIZE',\n  GetTemplates: 'GET_TEMPLATES',\n  SetSelectedTemplate: 'SET_SELECTED_TEMPLATE',\n  SaveCustomTemplate: 'SAVE_CUSTOM_TEMPLATE',\n  DeleteCustomTemplate: 'DELETE_CUSTOM_TEMPLATE',\n  ImportTemplates: 'IMPORT_TEMPLATES',\n  ExportTemplates: 'EXPORT_TEMPLATES'\n} as const;\n\nexport type MessageKind = typeof MessageType[keyof typeof MessageType];\n\nexport type OptimizePromptRequest = {\n  type: typeof MessageType.OptimizePrompt;\n  payload: {\n    originalPrompt: string;\n    templateId: string;\n    styleId?: string;\n    source?: 'content-script' | 'popup';\n    pageHost?: string;\n  };\n};\n\nexport type OptimizePromptResponse = {\n  success: boolean;\n  optimizedPrompt?: string;\n  error?: string;\n};\n\nexport type TriggerOptimizeMessage = {\n  type: typeof MessageType.TriggerOptimize;\n};\n\nexport function isOptimizePromptRequest(message: unknown): message is OptimizePromptRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as OptimizePromptRequest;\n  return typed.type === MessageType.OptimizePrompt && Boolean(typed.payload?.originalPrompt);\n}\n\nexport function isTriggerOptimizeMessage(message: unknown): message is TriggerOptimizeMessage {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as TriggerOptimizeMessage;\n  return typed.type === MessageType.TriggerOptimize;\n}\n\n// ============================================================\n// TEMPLATE MESSAGE TYPES\n// ============================================================\n\nexport type GetTemplatesRequest = {\n  type: typeof MessageType.GetTemplates;\n};\n\nexport type GetTemplatesResponse = {\n  success: boolean;\n  templates: PromptTemplate[];\n  selectedTemplateId: string;\n  error?: string;\n};\n\nexport type SetSelectedTemplateRequest = {\n  type: typeof MessageType.SetSelectedTemplate;\n  payload: {\n    templateId: string;\n  };\n};\n\nexport type SetSelectedTemplateResponse = {\n  success: boolean;\n  error?: string;\n};\n\nexport type SaveCustomTemplateRequest = {\n  type: typeof MessageType.SaveCustomTemplate;\n  payload: {\n    template: Omit<PromptTemplate, 'type'>;\n    isNew: boolean;\n  };\n};\n\nexport type SaveCustomTemplateResponse = {\n  success: boolean;\n  template?: PromptTemplate;\n  error?: string;\n};\n\nexport type DeleteCustomTemplateRequest = {\n  type: typeof MessageType.DeleteCustomTemplate;\n  payload: {\n    templateId: string;\n  };\n};\n\nexport type DeleteCustomTemplateResponse = {\n  success: boolean;\n  error?: string;\n};\n\nexport type ImportTemplatesRequest = {\n  type: typeof MessageType.ImportTemplates;\n  payload: {\n    exportedData: ExportedTemplates;\n    conflictResolution: 'skip' | 'replace' | 'rename';\n  };\n};\n\nexport type ImportTemplatesResponse = {\n  success: boolean;\n  importedCount: number;\n  skippedCount: number;\n  errors?: string[];\n};\n\nexport type ExportTemplatesRequest = {\n  type: typeof MessageType.ExportTemplates;\n};\n\nexport type ExportTemplatesResponse = {\n  success: boolean;\n  exportedData?: ExportedTemplates;\n  error?: string;\n};\n\n// ============================================================\n// TYPE GUARDS FOR TEMPLATE MESSAGES\n// ============================================================\n\nexport function isGetTemplatesRequest(message: unknown): message is GetTemplatesRequest {\n  if (!message || typeof message !== 'object') return false;\n  return (message as GetTemplatesRequest).type === MessageType.GetTemplates;\n}\n\nexport function isSetSelectedTemplateRequest(message: unknown): message is SetSelectedTemplateRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as SetSelectedTemplateRequest;\n  return typed.type === MessageType.SetSelectedTemplate && typeof typed.payload?.templateId === 'string';\n}\n\nexport function isSaveCustomTemplateRequest(message: unknown): message is SaveCustomTemplateRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as SaveCustomTemplateRequest;\n  return typed.type === MessageType.SaveCustomTemplate && typeof typed.payload?.template === 'object';\n}\n\nexport function isDeleteCustomTemplateRequest(message: unknown): message is DeleteCustomTemplateRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as DeleteCustomTemplateRequest;\n  return typed.type === MessageType.DeleteCustomTemplate && typeof typed.payload?.templateId === 'string';\n}\n\nexport function isImportTemplatesRequest(message: unknown): message is ImportTemplatesRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as ImportTemplatesRequest;\n  return typed.type === MessageType.ImportTemplates && typeof typed.payload?.exportedData === 'object';\n}\n\nexport function isExportTemplatesRequest(message: unknown): message is ExportTemplatesRequest {\n  if (!message || typeof message !== 'object') return false;\n  return (message as ExportTemplatesRequest).type === MessageType.ExportTemplates;\n}\n\n// Re-export template types for convenience\nexport type { PromptTemplate, ExportedTemplates } from './templates';\n", "import {\n  MessageType,\n  OptimizePromptResponse,\n  GetTemplatesResponse,\n  SetSelectedTemplateResponse,\n  PromptTemplate\n} from '../shared/messages';\n\nconst inputEl = document.getElementById('inputPrompt') as HTMLTextAreaElement;\nconst outputEl = document.getElementById('outputPrompt') as HTMLTextAreaElement;\nconst statusEl = document.getElementById('statusText') as HTMLDivElement;\nconst optimizeBtn = document.getElementById('optimizeBtn') as HTMLButtonElement;\nconst copyBtn = document.getElementById('copyBtn') as HTMLButtonElement;\nconst clearBtn = document.getElementById('clearBtn') as HTMLButtonElement;\nconst scenarioSelect = document.getElementById('scenarioSelect') as HTMLSelectElement;\nconst presetGroup = document.getElementById('presetGroup') as HTMLOptGroupElement;\nconst customGroup = document.getElementById('customGroup') as HTMLOptGroupElement;\nconst scenarioStatus = document.getElementById('scenarioStatus') as HTMLSpanElement;\n\nlet currentTemplateId = 'general';\n\n// Initialize on load\ndocument.addEventListener('DOMContentLoaded', initPopup);\n\noptimizeBtn?.addEventListener('click', optimizePrompt);\ncopyBtn?.addEventListener('click', copyOutput);\nclearBtn?.addEventListener('click', clearFields);\nscenarioSelect?.addEventListener('change', handleScenarioChange);\n\nasync function initPopup() {\n  try {\n    const response = (await chrome.runtime.sendMessage({\n      type: MessageType.GetTemplates\n    })) as GetTemplatesResponse;\n\n    if (response?.success && response.templates) {\n      populateTemplates(response.templates, response.selectedTemplateId);\n    }\n  } catch (error) {\n    console.error('Failed to load templates:', error);\n  }\n}\n\nfunction populateTemplates(templates: PromptTemplate[], selectedId: string) {\n  // Clear existing options\n  if (presetGroup) presetGroup.innerHTML = '';\n  if (customGroup) customGroup.innerHTML = '';\n\n  const presets = templates.filter(t => t.type === 'preset');\n  const custom = templates.filter(t => t.type === 'custom');\n\n  // Add preset templates\n  for (const template of presets) {\n    const option = document.createElement('option');\n    option.value = template.id;\n    option.textContent = template.icon ? `${template.icon} ${template.name}` : template.name;\n    if (template.description) {\n      option.title = template.description;\n    }\n    presetGroup?.appendChild(option);\n  }\n\n  // Add custom templates\n  for (const template of custom) {\n    const option = document.createElement('option');\n    option.value = template.id;\n    option.textContent = template.icon ? `${template.icon} ${template.name}` : template.name;\n    if (template.description) {\n      option.title = template.description;\n    }\n    customGroup?.appendChild(option);\n  }\n\n  // Hide custom group if empty\n  if (customGroup) {\n    customGroup.style.display = custom.length > 0 ? '' : 'none';\n  }\n\n  // Set selected value\n  currentTemplateId = selectedId;\n  if (scenarioSelect) {\n    scenarioSelect.value = selectedId;\n  }\n}\n\nasync function handleScenarioChange() {\n  const newTemplateId = scenarioSelect?.value || 'general';\n\n  try {\n    const response = (await chrome.runtime.sendMessage({\n      type: MessageType.SetSelectedTemplate,\n      payload: { templateId: newTemplateId }\n    })) as SetSelectedTemplateResponse;\n\n    if (response?.success) {\n      currentTemplateId = newTemplateId;\n      showScenarioFeedback('\u5DF2\u5207\u6362');\n    } else {\n      setStatus(response?.error || '\u5207\u6362\u5931\u8D25');\n      // Revert selection\n      if (scenarioSelect) scenarioSelect.value = currentTemplateId;\n    }\n  } catch (error) {\n    console.error('Failed to set template:', error);\n    setStatus('\u5207\u6362\u5931\u8D25');\n    if (scenarioSelect) scenarioSelect.value = currentTemplateId;\n  }\n}\n\nfunction showScenarioFeedback(text: string) {\n  if (!scenarioStatus) return;\n  scenarioStatus.textContent = text;\n  scenarioStatus.classList.add('show');\n  setTimeout(() => {\n    scenarioStatus.classList.remove('show');\n  }, 1500);\n}\n\nfunction setStatus(text: string) {\n  if (!statusEl) return;\n  statusEl.textContent = text;\n}\n\nasync function optimizePrompt() {\n  const prompt = inputEl?.value.trim() || '';\n  if (!prompt) {\n    setStatus('\u8BF7\u8F93\u5165\u9700\u8981\u4F18\u5316\u7684 Prompt');\n    return;\n  }\n  setLoading(true);\n  setStatus('\u4F18\u5316\u4E2D...');\n  try {\n    const response = (await chrome.runtime.sendMessage({\n      type: MessageType.OptimizePrompt,\n      payload: {\n        originalPrompt: prompt,\n        templateId: currentTemplateId,\n        source: 'popup'\n      }\n    })) as OptimizePromptResponse;\n\n    if (!response?.success || !response.optimizedPrompt) {\n      setStatus(response?.error || '\u4F18\u5316\u5931\u8D25');\n      return;\n    }\n    if (outputEl) outputEl.value = response.optimizedPrompt;\n    setStatus('\u5B8C\u6210\uFF0C\u53EF\u590D\u5236\u6216\u7F16\u8F91');\n  } catch (error) {\n    console.error('Optimize failed', error);\n    setStatus('\u8BF7\u6C42\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u914D\u7F6E');\n  } finally {\n    setLoading(false);\n  }\n}\n\nfunction copyOutput() {\n  const value = outputEl?.value || '';\n  if (!value) {\n    setStatus('\u6682\u65E0\u53EF\u590D\u5236\u5185\u5BB9');\n    return;\n  }\n  navigator.clipboard\n    .writeText(value)\n    .then(() => setStatus('\u5DF2\u590D\u5236'))\n    .catch(() => setStatus('\u590D\u5236\u5931\u8D25'));\n}\n\nfunction clearFields() {\n  if (inputEl) inputEl.value = '';\n  if (outputEl) outputEl.value = '';\n  setStatus('');\n}\n\nfunction setLoading(loading: boolean) {\n  optimizeBtn.disabled = loading;\n  copyBtn.disabled = loading;\n  clearBtn.disabled = loading;\n  scenarioSelect.disabled = loading;\n  optimizeBtn.textContent = loading ? '\u4F18\u5316\u4E2D\u2026' : '\u2728 \u4F18\u5316';\n}\n"],
  "mappings": "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",
  "names": []
}
