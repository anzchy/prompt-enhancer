{
  "version": 3,
  "sources": ["../src/shared/config.ts", "../src/options/index.ts"],
  "sourcesContent": ["export type ExtensionConfig = {\n  apiBaseUrl: string;\n  apiKey: string;\n  model: string;\n  systemPrompt: string;\n};\n\nconst SYNC_KEY = 'promptEnhancerConfig';\nconst LOCAL_KEY = 'promptEnhancerSecrets';\n\nexport const DEFAULT_CONFIG: ExtensionConfig = {\n  apiBaseUrl: 'https://api.openai.com/v1',\n  apiKey: '',\n  model: 'gpt-4.1-mini',\n  systemPrompt:\n    'You upgrade user prompts into concise, structured prompts with clear inputs, outputs, and constraints. Return only the improved prompt.'\n};\n\ntype StorageArea = 'sync' | 'local';\n\nfunction readFromStorage<T>(area: StorageArea, key: string): Promise<T | undefined> {\n  return new Promise((resolve) => {\n    const storageArea = chrome?.storage?.[area];\n    if (!storageArea) {\n      resolve(undefined);\n      return;\n    }\n    storageArea.get(key, (result: Record<string, T>) => resolve(result?.[key]));\n  });\n}\n\nfunction writeToStorage<T>(area: StorageArea, key: string, value: T): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const storageArea = chrome?.storage?.[area];\n    if (!storageArea) {\n      resolve();\n      return;\n    }\n    storageArea.set({ [key]: value }, () => {\n      const lastError = chrome.runtime?.lastError;\n      if (lastError) {\n        reject(lastError);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport async function loadConfig(): Promise<ExtensionConfig> {\n  const [syncConfig, localSecrets] = await Promise.all([\n    readFromStorage<ExtensionConfig>('sync', SYNC_KEY),\n    readFromStorage<{ apiKey: string }>('local', LOCAL_KEY)\n  ]);\n\n  return {\n    ...DEFAULT_CONFIG,\n    ...syncConfig,\n    apiKey: localSecrets?.apiKey ?? syncConfig?.apiKey ?? ''\n  };\n}\n\nexport async function saveConfig(next: ExtensionConfig): Promise<void> {\n  const { apiKey, ...rest } = next;\n  await Promise.all([\n    writeToStorage('sync', SYNC_KEY, rest),\n    writeToStorage('local', LOCAL_KEY, { apiKey })\n  ]);\n}\n\nexport function normalizeApiBase(url: string): string {\n  const trimmed = url.trim();\n  if (!trimmed) return DEFAULT_CONFIG.apiBaseUrl;\n  return trimmed.endsWith('/') ? trimmed.slice(0, -1) : trimmed;\n}\n", "import { DEFAULT_CONFIG, loadConfig, normalizeApiBase, saveConfig } from '../shared/config';\n\nconst apiBaseInput = document.getElementById('apiBaseUrl') as HTMLInputElement;\nconst apiKeyInput = document.getElementById('apiKey') as HTMLInputElement;\nconst modelInput = document.getElementById('model') as HTMLInputElement;\nconst systemPromptInput = document.getElementById('systemPrompt') as HTMLTextAreaElement;\nconst saveBtn = document.getElementById('saveBtn') as HTMLButtonElement;\nconst statusEl = document.getElementById('statusText') as HTMLDivElement;\n\ninit();\nsaveBtn?.addEventListener('click', onSave);\n\nasync function init() {\n  try {\n    const config = await loadConfig();\n    if (apiBaseInput) apiBaseInput.value = config.apiBaseUrl || DEFAULT_CONFIG.apiBaseUrl;\n    if (apiKeyInput) apiKeyInput.value = config.apiKey || '';\n    if (modelInput) modelInput.value = config.model || DEFAULT_CONFIG.model;\n    if (systemPromptInput) systemPromptInput.value = config.systemPrompt || DEFAULT_CONFIG.systemPrompt;\n  } catch (error) {\n    console.error('Failed to load config', error);\n    setStatus('\u52A0\u8F7D\u914D\u7F6E\u5931\u8D25');\n  }\n}\n\nasync function onSave() {\n  const apiBaseUrl = normalizeApiBase(apiBaseInput?.value || DEFAULT_CONFIG.apiBaseUrl);\n  const apiKey = apiKeyInput?.value.trim() || '';\n  const model = (modelInput?.value.trim() || DEFAULT_CONFIG.model).trim();\n  const systemPrompt = systemPromptInput?.value.trim() || DEFAULT_CONFIG.systemPrompt;\n\n  try {\n    await saveConfig({ apiBaseUrl, apiKey, model, systemPrompt });\n    setStatus('\u5DF2\u4FDD\u5B58');\n  } catch (error) {\n    console.error('Save failed', error);\n    setStatus('\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5');\n  }\n}\n\nfunction setStatus(text: string) {\n  if (!statusEl) return;\n  statusEl.textContent = text;\n}\n"],
  "mappings": "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",
  "names": []
}
