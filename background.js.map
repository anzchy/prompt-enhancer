{
  "version": 3,
  "sources": ["../src/shared/templates.ts", "../src/shared/config.ts", "../src/shared/llm.ts", "../src/shared/messages.ts", "../src/background/index.ts"],
  "sourcesContent": ["/**\n * Specialized Prompt Templates System\n *\n * Defines the PromptTemplate interface and preset templates for different optimization scenarios.\n * Per data-model.md and contracts/messages.ts\n */\n\n// ============================================================\n// TYPES\n// ============================================================\n\nexport interface PromptTemplate {\n  id: string;\n  name: string;\n  systemPrompt: string;\n  description?: string;\n  type: 'preset' | 'custom';\n  icon?: string;\n  createdAt?: number;\n}\n\nexport interface ExportedTemplates {\n  version: string;\n  exportedAt: string;\n  templates: PromptTemplate[];\n}\n\n// ============================================================\n// PRESET TEMPLATES\n// ============================================================\n\nexport const PRESET_TEMPLATES: PromptTemplate[] = [\n  {\n    id: 'general',\n    name: '\u901A\u7528\u4F18\u5316',\n    description: '\u7ED3\u6784\u5316\u4F18\u5316\uFF0C\u660E\u786E\u8F93\u5165\u8F93\u51FA\u548C\u7EA6\u675F\u6761\u4EF6',\n    icon: '\u2728',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u4E13\u4E1A\u7684\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u4F60\u7684\u4EFB\u52A1\u662F\u5C06\u7528\u6237\u7684\u539F\u59CB\u63D0\u793A\u8BCD\u5347\u7EA7\u4E3A\u7ED3\u6784\u5316\u3001\u6E05\u6670\u3001\u9AD8\u6548\u7684\u7248\u672C\u3002\n\n\u4F18\u5316\u539F\u5219\uFF1A\n1. \u660E\u786E\u4EFB\u52A1\u76EE\u6807\uFF1A\u6E05\u695A\u8BF4\u660E\u8981\u5B8C\u6210\u4EC0\u4E48\n2. \u5B9A\u4E49\u8F93\u5165\u8F93\u51FA\uFF1A\u660E\u786E\u8F93\u5165\u683C\u5F0F\u548C\u671F\u671B\u7684\u8F93\u51FA\u683C\u5F0F\n3. \u6DFB\u52A0\u7EA6\u675F\u6761\u4EF6\uFF1A\u5FC5\u8981\u7684\u9650\u5236\u3001\u98CE\u683C\u8981\u6C42\u3001\u957F\u5EA6\u9650\u5236\u7B49\n4. \u63D0\u4F9B\u4E0A\u4E0B\u6587\uFF1A\u8865\u5145\u6709\u52A9\u4E8E\u7406\u89E3\u4EFB\u52A1\u7684\u80CC\u666F\u4FE1\u606F\n5. \u4FDD\u6301\u7B80\u6D01\uFF1A\u53BB\u9664\u5197\u4F59\uFF0C\u4FDD\u7559\u6838\u5FC3\u8981\u7D20\n\n\u8F93\u51FA\u683C\u5F0F\uFF1A\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u63D0\u793A\u8BCD\n- \u4E0D\u8981\u6DFB\u52A0\u89E3\u91CA\u6216\u8BF4\u660E\n- \u4FDD\u6301\u7528\u6237\u539F\u6709\u7684\u8BED\u8A00\uFF08\u4E2D\u6587\u6216\u82F1\u6587\uFF09`\n  },\n  {\n    id: 'translate',\n    name: '\u7FFB\u8BD1\u52A9\u624B',\n    description: '\u4F18\u5316\u7FFB\u8BD1\u8BF7\u6C42\uFF0C\u660E\u786E\u8BED\u8A00\u3001\u8BED\u6C14\u3001\u672F\u8BED\u5904\u7406',\n    icon: '\uD83C\uDF10',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u7FFB\u8BD1\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u5C06\u7528\u6237\u7684\u7FFB\u8BD1\u8BF7\u6C42\u4F18\u5316\u4E3A\u4E13\u4E1A\u3001\u7CBE\u786E\u7684\u7FFB\u8BD1\u6307\u4EE4\u3002\n\n\u4F18\u5316\u8981\u70B9\uFF1A\n1. \u660E\u786E\u6E90\u8BED\u8A00\u548C\u76EE\u6807\u8BED\u8A00\n2. \u6307\u5B9A\u7FFB\u8BD1\u98CE\u683C\uFF08\u6B63\u5F0F/\u53E3\u8BED/\u6587\u5B66/\u6280\u672F\uFF09\n3. \u5904\u7406\u4E13\u4E1A\u672F\u8BED\u7684\u8981\u6C42\n4. \u6587\u5316\u9002\u5E94\u6027\u8981\u6C42\n5. \u683C\u5F0F\u4FDD\u7559\u8981\u6C42\uFF08\u5982\u4FDD\u7559\u539F\u6709\u6BB5\u843D\u7ED3\u6784\uFF09\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\n- \u660E\u786E\u6307\u51FA\"\u5C06[\u6E90\u8BED\u8A00]\u7FFB\u8BD1\u4E3A[\u76EE\u6807\u8BED\u8A00]\"\n- \u8BF4\u660E\u8BED\u6C14\u548C\u98CE\u683C\u8981\u6C42\n- \u5982\u6D89\u53CA\u4E13\u4E1A\u9886\u57DF\uFF0C\u6307\u660E\u9886\u57DF\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u7FFB\u8BD1\u63D0\u793A\u8BCD`\n  },\n  {\n    id: 'company-research',\n    name: '\u516C\u53F8\u7814\u7A76',\n    description: '\u7ED3\u6784\u5316\u516C\u53F8\u8C03\u7814\uFF0C\u5305\u542B\u5546\u4E1A\u6A21\u5F0F\u3001\u878D\u8D44\u3001\u7ADE\u4E89\u7B49',\n    icon: '\uD83C\uDFE2',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u516C\u53F8\u7814\u7A76\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u5C06\u7528\u6237\u7684\u516C\u53F8\u8C03\u7814\u8BF7\u6C42\u4F18\u5316\u4E3A\u5168\u9762\u3001\u7ED3\u6784\u5316\u7684\u7814\u7A76\u6307\u4EE4\u3002\n\n\u4F18\u5316\u8981\u70B9\uFF1A\n1. \u516C\u53F8\u57FA\u672C\u4FE1\u606F\uFF08\u6210\u7ACB\u65F6\u95F4\u3001\u603B\u90E8\u3001\u521B\u59CB\u4EBA\uFF09\n2. \u5546\u4E1A\u6A21\u5F0F\u548C\u4E3B\u8981\u4EA7\u54C1/\u670D\u52A1\n3. \u878D\u8D44\u5386\u53F2\u548C\u4F30\u503C\uFF08\u5982\u9002\u7528\uFF09\n4. \u5E02\u573A\u5B9A\u4F4D\u548C\u76EE\u6807\u5BA2\u6237\n5. \u7ADE\u4E89\u5BF9\u624B\u5206\u6790\n6. \u6280\u672F\u6808\u548C\u6838\u5FC3\u4F18\u52BF\n7. \u6700\u65B0\u52A8\u6001\u548C\u53D1\u5C55\u8D8B\u52BF\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\n- \u7ED3\u6784\u5316\u5448\u73B0\u5404\u4E2A\u7EF4\u5EA6\n- \u8981\u6C42\u63D0\u4F9B\u6570\u636E\u6765\u6E90\n- \u533A\u5206\u4E8B\u5B9E\u548C\u63A8\u6D4B\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u516C\u53F8\u7814\u7A76\u63D0\u793A\u8BCD`\n  },\n  {\n    id: 'tech-explainer',\n    name: '\u6280\u672F\u6982\u5FF5',\n    description: '\u901A\u4FD7\u89E3\u91CA\u6280\u672F\u672F\u8BED\uFF0C\u5305\u542B\u7C7B\u6BD4\u3001\u7528\u4F8B\u3001\u5BF9\u6BD4',\n    icon: '\uD83D\uDCA1',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u6280\u672F\u6982\u5FF5\u89E3\u91CA\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u5C06\u7528\u6237\u7684\u6280\u672F\u5B66\u4E60\u8BF7\u6C42\u4F18\u5316\u4E3A\u6613\u4E8E\u7406\u89E3\u7684\u89E3\u91CA\u6307\u4EE4\u3002\n\n\u4F18\u5316\u8981\u70B9\uFF1A\n1. \u7528\u901A\u4FD7\u8BED\u8A00\u89E3\u91CA\u6838\u5FC3\u6982\u5FF5\n2. \u63D0\u4F9B\u751F\u6D3B\u5316\u7684\u7C7B\u6BD4\n3. \u7ED9\u51FA\u5B9E\u9645\u5E94\u7528\u573A\u666F\n4. \u4E0E\u76F8\u5173\u6280\u672F\u7684\u5BF9\u6BD4\n5. \u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE\n6. \u5E38\u89C1\u8BEF\u533A\u63D0\u9192\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\n- \u8981\u6C42\u5206\u5C42\u6B21\u89E3\u91CA\uFF08\u5165\u95E8/\u8FDB\u9636\uFF09\n- \u5305\u542B\u5177\u4F53\u793A\u4F8B\n- \u907F\u514D\u8FC7\u591A\u4E13\u4E1A\u672F\u8BED\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u6280\u672F\u5B66\u4E60\u63D0\u793A\u8BCD`\n  },\n  {\n    id: 'code-gen',\n    name: '\u4EE3\u7801\u751F\u6210',\n    description: '\u660E\u786E\u7F16\u7A0B\u9700\u6C42\uFF0C\u5305\u542B\u8BED\u8A00\u3001\u7C7B\u578B\u3001\u9519\u8BEF\u5904\u7406',\n    icon: '\uD83D\uDCBB',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u4EE3\u7801\u751F\u6210\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u5C06\u7528\u6237\u7684\u7F16\u7A0B\u9700\u6C42\u4F18\u5316\u4E3A\u7CBE\u786E\u3001\u5B8C\u6574\u7684\u4EE3\u7801\u751F\u6210\u6307\u4EE4\u3002\n\n\u4F18\u5316\u8981\u70B9\uFF1A\n1. \u660E\u786E\u7F16\u7A0B\u8BED\u8A00\u548C\u7248\u672C\n2. \u6307\u5B9A\u4EE3\u7801\u529F\u80FD\u548C\u8F93\u5165\u8F93\u51FA\n3. \u7C7B\u578B\u5B9A\u4E49\u8981\u6C42\uFF08TypeScript/\u7C7B\u578B\u6CE8\u89E3\uFF09\n4. \u9519\u8BEF\u5904\u7406\u8981\u6C42\n5. \u4EE3\u7801\u98CE\u683C\u548C\u547D\u540D\u89C4\u8303\n6. \u6027\u80FD\u548C\u5B89\u5168\u8003\u8651\n7. \u6D4B\u8BD5\u7528\u4F8B\u8981\u6C42\uFF08\u5982\u9700\u8981\uFF09\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\n- \u660E\u786E\u6307\u5B9A\u7F16\u7A0B\u8BED\u8A00\n- \u8BF4\u660E\u51FD\u6570\u7B7E\u540D/\u63A5\u53E3\n- \u8981\u6C42\u6DFB\u52A0\u5FC5\u8981\u6CE8\u91CA\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u4EE3\u7801\u751F\u6210\u63D0\u793A\u8BCD`\n  },\n  {\n    id: 'writing',\n    name: '\u5199\u4F5C\u6DA6\u8272',\n    description: '\u6539\u5584\u6587\u7AE0\u6D41\u7545\u5EA6\uFF0C\u4FDD\u6301\u539F\u6709\u98CE\u683C',\n    icon: '\u270D\uFE0F',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u5199\u4F5C\u6DA6\u8272\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u5C06\u7528\u6237\u7684\u5199\u4F5C\u6DA6\u8272\u8BF7\u6C42\u4F18\u5316\u4E3A\u4E13\u4E1A\u7684\u7F16\u8F91\u6307\u4EE4\u3002\n\n\u4F18\u5316\u8981\u70B9\uFF1A\n1. \u4FDD\u6301\u539F\u6587\u98CE\u683C\u548C\u8BED\u6C14\n2. \u6539\u5584\u8BED\u53E5\u6D41\u7545\u5EA6\n3. \u4FEE\u6B63\u8BED\u6CD5\u548C\u7528\u8BCD\u9519\u8BEF\n4. \u589E\u5F3A\u6587\u7AE0\u903B\u8F91\u6027\n5. \u9002\u5F53\u8C03\u6574\u6BB5\u843D\u7ED3\u6784\n6. \u4FDD\u7559\u4F5C\u8005\u7684\u4E2A\u4EBA\u7279\u8272\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\n- \u660E\u786E\u6DA6\u8272\u76EE\u6807\uFF08\u6D41\u7545\u5EA6/\u4E13\u4E1A\u5EA6/\u53EF\u8BFB\u6027\uFF09\n- \u6307\u5B9A\u4FDD\u7559\u7684\u98CE\u683C\u5143\u7D20\n- \u8BF4\u660E\u4FEE\u6539\u7A0B\u5EA6\uFF08\u8F7B\u5FAE/\u9002\u5EA6/\u5927\u5E45\uFF09\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u5199\u4F5C\u6DA6\u8272\u63D0\u793A\u8BCD`\n  },\n  {\n    id: 'summarize',\n    name: '\u5185\u5BB9\u603B\u7ED3',\n    description: '\u63D0\u53D6\u8981\u70B9\uFF0C\u4FDD\u7559\u5173\u952E\u6570\u636E\uFF0C\u63A7\u5236\u957F\u5EA6',\n    icon: '\uD83D\uDCDD',\n    type: 'preset',\n    systemPrompt: `\u4F60\u662F\u4E00\u4E2A\u5185\u5BB9\u603B\u7ED3\u63D0\u793A\u8BCD\u4F18\u5316\u4E13\u5BB6\u3002\u5C06\u7528\u6237\u7684\u603B\u7ED3\u8BF7\u6C42\u4F18\u5316\u4E3A\u7CBE\u51C6\u7684\u5185\u5BB9\u63D0\u70BC\u6307\u4EE4\u3002\n\n\u4F18\u5316\u8981\u70B9\uFF1A\n1. \u660E\u786E\u603B\u7ED3\u7684\u957F\u5EA6\u8981\u6C42\n2. \u63D0\u53D6\u6838\u5FC3\u89C2\u70B9\u548C\u5173\u952E\u6570\u636E\n3. \u4FDD\u7559\u91CD\u8981\u7684\u6570\u5B57\u548C\u4E8B\u5B9E\n4. \u6309\u903B\u8F91\u7ED3\u6784\u7EC4\u7EC7\n5. \u533A\u5206\u4E3B\u8981\u548C\u6B21\u8981\u4FE1\u606F\n6. \u9002\u5F53\u4FDD\u7559\u539F\u6587\u8868\u8FF0\n\n\u8F93\u51FA\u683C\u5F0F\u8981\u6C42\uFF1A\n- \u6307\u5B9A\u8F93\u51FA\u957F\u5EA6\uFF08\u5B57\u6570/\u6BB5\u843D\u6570/\u8981\u70B9\u6570\uFF09\n- \u8981\u6C42\u4FDD\u7559\u5173\u952E\u6570\u636E\n- \u8BF4\u660E\u603B\u7ED3\u98CE\u683C\uFF08\u6982\u8FF0/\u8981\u70B9/\u6458\u8981\uFF09\n- \u53EA\u8FD4\u56DE\u4F18\u5316\u540E\u7684\u5185\u5BB9\u603B\u7ED3\u63D0\u793A\u8BCD`\n  }\n];\n\n// ============================================================\n// UTILITY FUNCTIONS\n// ============================================================\n\n/**\n * Validate a template has all required fields\n */\nexport function validateTemplate(template: Partial<PromptTemplate>): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n\n  if (!template.id || typeof template.id !== 'string') {\n    errors.push('ID is required and must be a string');\n  }\n\n  if (!template.name || typeof template.name !== 'string') {\n    errors.push('Name is required and must be a string');\n  } else if (template.name.length > 50) {\n    errors.push('Name must be 50 characters or less');\n  }\n\n  if (!template.systemPrompt || typeof template.systemPrompt !== 'string') {\n    errors.push('System prompt is required and must be a string');\n  } else if (template.systemPrompt.length > 4000) {\n    errors.push('System prompt must be 4000 characters or less');\n  }\n\n  if (template.description && template.description.length > 200) {\n    errors.push('Description must be 200 characters or less');\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors\n  };\n}\n\n/**\n * Generate a unique template ID using crypto.randomUUID\n */\nexport function generateTemplateId(): string {\n  return crypto.randomUUID();\n}\n\n/**\n * Merge preset templates with custom templates\n * Presets come first, then custom templates sorted by createdAt (newest first)\n */\nexport function mergeTemplates(presets: PromptTemplate[], custom: PromptTemplate[]): PromptTemplate[] {\n  const sortedCustom = [...custom].sort((a, b) => {\n    const aTime = a.createdAt ?? 0;\n    const bTime = b.createdAt ?? 0;\n    return bTime - aTime; // newest first\n  });\n  return [...presets, ...sortedCustom];\n}\n\n/**\n * Find a template by ID, with fallback to 'general' preset\n */\nexport function findTemplateById(templates: PromptTemplate[], id: string): PromptTemplate {\n  const found = templates.find(t => t.id === id);\n  if (found) return found;\n\n  // Fallback to general preset\n  const general = PRESET_TEMPLATES.find(t => t.id === 'general');\n  if (general) return general;\n\n  // Ultimate fallback (should never happen)\n  return PRESET_TEMPLATES[0];\n}\n\n/**\n * Check if a template ID is a preset\n */\nexport function isPresetTemplate(id: string): boolean {\n  return PRESET_TEMPLATES.some(t => t.id === id);\n}\n\n/**\n * Get preset template by ID\n */\nexport function getPresetTemplate(id: string): PromptTemplate | undefined {\n  return PRESET_TEMPLATES.find(t => t.id === id);\n}\n", "import { PromptTemplate, PRESET_TEMPLATES, mergeTemplates } from './templates';\n\nexport type ExtensionConfig = {\n  apiBaseUrl: string;\n  apiKey: string;\n  model: string;\n  systemPrompt: string;\n};\n\nconst SYNC_KEY = 'promptEnhancerConfig';\nconst LOCAL_KEY = 'promptEnhancerSecrets';\nconst SYNC_TEMPLATES_KEY = 'promptEnhancerTemplates';\n\n// Template storage constants\nconst DEFAULT_SELECTED_TEMPLATE_ID = 'general';\nconst MAX_RECENT_TEMPLATES = 10;\n\nexport const DEFAULT_CONFIG: ExtensionConfig = {\n  apiBaseUrl: 'https://api.openai.com/v1',\n  apiKey: '',\n  model: 'gpt-4.1-mini',\n  systemPrompt:\n    'You upgrade user prompts into concise, structured prompts with clear inputs, outputs, and constraints. Return only the improved prompt.'\n};\n\ntype StorageArea = 'sync' | 'local';\n\nfunction readFromStorage<T>(area: StorageArea, key: string): Promise<T | undefined> {\n  return new Promise((resolve) => {\n    const storageArea = chrome?.storage?.[area];\n    if (!storageArea) {\n      resolve(undefined);\n      return;\n    }\n    storageArea.get(key, (result: Record<string, T>) => resolve(result?.[key]));\n  });\n}\n\nfunction writeToStorage<T>(area: StorageArea, key: string, value: T): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const storageArea = chrome?.storage?.[area];\n    if (!storageArea) {\n      resolve();\n      return;\n    }\n    storageArea.set({ [key]: value }, () => {\n      const lastError = chrome.runtime?.lastError;\n      if (lastError) {\n        reject(lastError);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport async function loadConfig(): Promise<ExtensionConfig> {\n  const [syncConfig, localSecrets] = await Promise.all([\n    readFromStorage<ExtensionConfig>('sync', SYNC_KEY),\n    readFromStorage<{ apiKey: string }>('local', LOCAL_KEY)\n  ]);\n\n  return {\n    ...DEFAULT_CONFIG,\n    ...syncConfig,\n    apiKey: localSecrets?.apiKey ?? syncConfig?.apiKey ?? ''\n  };\n}\n\nexport async function saveConfig(next: ExtensionConfig): Promise<void> {\n  const { apiKey, ...rest } = next;\n  await Promise.all([\n    writeToStorage('sync', SYNC_KEY, rest),\n    writeToStorage('local', LOCAL_KEY, { apiKey })\n  ]);\n}\n\nexport function normalizeApiBase(url: string): string {\n  const trimmed = url.trim();\n  if (!trimmed) return DEFAULT_CONFIG.apiBaseUrl;\n  return trimmed.endsWith('/') ? trimmed.slice(0, -1) : trimmed;\n}\n\n// ============================================================\n// TEMPLATE STORAGE FUNCTIONS\n// ============================================================\n\ninterface LocalSecretsData {\n  apiKey?: string;\n  selectedTemplateId?: string;\n  recentTemplates?: string[];\n}\n\ninterface SyncTemplatesData {\n  customTemplates?: PromptTemplate[];\n}\n\n/**\n * Load all templates (presets merged with custom)\n */\nexport async function loadAllTemplates(): Promise<PromptTemplate[]> {\n  const custom = await loadCustomTemplates();\n  return mergeTemplates(PRESET_TEMPLATES, custom);\n}\n\n/**\n * Load custom templates only from sync storage\n */\nexport async function loadCustomTemplates(): Promise<PromptTemplate[]> {\n  const data = await readFromStorage<SyncTemplatesData>('sync', SYNC_TEMPLATES_KEY);\n  return data?.customTemplates ?? [];\n}\n\n/**\n * Save custom templates to sync storage\n */\nexport async function saveCustomTemplates(templates: PromptTemplate[]): Promise<void> {\n  await writeToStorage<SyncTemplatesData>('sync', SYNC_TEMPLATES_KEY, {\n    customTemplates: templates\n  });\n}\n\n/**\n * Get the currently selected template ID\n */\nexport async function getSelectedTemplateId(): Promise<string> {\n  const data = await readFromStorage<LocalSecretsData>('local', LOCAL_KEY);\n  return data?.selectedTemplateId ?? DEFAULT_SELECTED_TEMPLATE_ID;\n}\n\n/**\n * Set the selected template ID\n */\nexport async function setSelectedTemplateId(templateId: string): Promise<void> {\n  const data = await readFromStorage<LocalSecretsData>('local', LOCAL_KEY) ?? {};\n  await writeToStorage<LocalSecretsData>('local', LOCAL_KEY, {\n    ...data,\n    selectedTemplateId: templateId\n  });\n}\n\n/**\n * Get recent template IDs\n */\nexport async function getRecentTemplates(): Promise<string[]> {\n  const data = await readFromStorage<LocalSecretsData>('local', LOCAL_KEY);\n  return data?.recentTemplates ?? [];\n}\n\n/**\n * Add template to recent list (moves to front if exists)\n */\nexport async function addToRecentTemplates(templateId: string): Promise<void> {\n  const data = await readFromStorage<LocalSecretsData>('local', LOCAL_KEY) ?? {};\n  const recent = data.recentTemplates ?? [];\n\n  // Remove if already exists, then add to front\n  const filtered = recent.filter(id => id !== templateId);\n  const updated = [templateId, ...filtered].slice(0, MAX_RECENT_TEMPLATES);\n\n  await writeToStorage<LocalSecretsData>('local', LOCAL_KEY, {\n    ...data,\n    recentTemplates: updated\n  });\n}\n\n/**\n * Get estimated storage usage for quota warnings\n * Returns percentage of sync storage used (0-100)\n */\nexport async function getStorageUsagePercent(): Promise<number> {\n  return new Promise((resolve) => {\n    if (!chrome?.storage?.sync?.getBytesInUse) {\n      resolve(0);\n      return;\n    }\n    chrome.storage.sync.getBytesInUse(null, (bytesInUse) => {\n      // Chrome sync storage quota is 102,400 bytes\n      const quota = 102400;\n      const percent = Math.round((bytesInUse / quota) * 100);\n      resolve(percent);\n    });\n  });\n}\n", "import { ExtensionConfig, normalizeApiBase } from './config';\n\ntype ChatCompletionChoice = { message?: { content?: string } };\ntype ChatCompletionResponse = { choices?: ChatCompletionChoice[] };\n\nexport async function requestOptimizedPrompt(\n  config: ExtensionConfig,\n  originalPrompt: string,\n  pageHost?: string\n): Promise<string> {\n  if (!originalPrompt.trim()) {\n    throw new Error('Prompt is empty');\n  }\n  if (!config.apiKey) {\n    throw new Error('API key is missing');\n  }\n\n  const endpoint = `${normalizeApiBase(config.apiBaseUrl)}/chat/completions`;\n  const systemPrompt = config.systemPrompt || '';\n  const userContent = buildUserContent(originalPrompt, pageHost);\n\n  const response = await fetch(endpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${config.apiKey}`\n    },\n    body: JSON.stringify({\n      model: config.model,\n      messages: [\n        { role: 'system', content: systemPrompt },\n        { role: 'user', content: userContent }\n      ]\n    })\n  });\n\n  if (!response.ok) {\n    const text = await response.text().catch(() => '');\n    throw new Error(`Model request failed (${response.status}): ${text || 'unknown error'}`);\n  }\n\n  const data = (await response.json()) as ChatCompletionResponse;\n  const optimized = data?.choices?.[0]?.message?.content?.trim();\n  if (!optimized) {\n    throw new Error('Model returned no content');\n  }\n  return optimized;\n}\n\nfunction buildUserContent(originalPrompt: string, pageHost?: string): string {\n  const hostLine = pageHost ? `Target host: ${pageHost}\\n` : '';\n  return `${hostLine}Optimize the following prompt. Return only the improved prompt:\\n\\n${originalPrompt}`;\n}\n", "import type { PromptTemplate, ExportedTemplates } from './templates';\n\nexport const MessageType = {\n  OptimizePrompt: 'OPTIMIZE_PROMPT',\n  TriggerOptimize: 'TRIGGER_OPTIMIZE',\n  GetTemplates: 'GET_TEMPLATES',\n  SetSelectedTemplate: 'SET_SELECTED_TEMPLATE',\n  SaveCustomTemplate: 'SAVE_CUSTOM_TEMPLATE',\n  DeleteCustomTemplate: 'DELETE_CUSTOM_TEMPLATE',\n  ImportTemplates: 'IMPORT_TEMPLATES',\n  ExportTemplates: 'EXPORT_TEMPLATES'\n} as const;\n\nexport type MessageKind = typeof MessageType[keyof typeof MessageType];\n\nexport type OptimizePromptRequest = {\n  type: typeof MessageType.OptimizePrompt;\n  payload: {\n    originalPrompt: string;\n    templateId: string;\n    styleId?: string;\n    source?: 'content-script' | 'popup';\n    pageHost?: string;\n  };\n};\n\nexport type OptimizePromptResponse = {\n  success: boolean;\n  optimizedPrompt?: string;\n  error?: string;\n};\n\nexport type TriggerOptimizeMessage = {\n  type: typeof MessageType.TriggerOptimize;\n};\n\nexport function isOptimizePromptRequest(message: unknown): message is OptimizePromptRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as OptimizePromptRequest;\n  return typed.type === MessageType.OptimizePrompt && Boolean(typed.payload?.originalPrompt);\n}\n\nexport function isTriggerOptimizeMessage(message: unknown): message is TriggerOptimizeMessage {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as TriggerOptimizeMessage;\n  return typed.type === MessageType.TriggerOptimize;\n}\n\n// ============================================================\n// TEMPLATE MESSAGE TYPES\n// ============================================================\n\nexport type GetTemplatesRequest = {\n  type: typeof MessageType.GetTemplates;\n};\n\nexport type GetTemplatesResponse = {\n  success: boolean;\n  templates: PromptTemplate[];\n  selectedTemplateId: string;\n  error?: string;\n};\n\nexport type SetSelectedTemplateRequest = {\n  type: typeof MessageType.SetSelectedTemplate;\n  payload: {\n    templateId: string;\n  };\n};\n\nexport type SetSelectedTemplateResponse = {\n  success: boolean;\n  error?: string;\n};\n\nexport type SaveCustomTemplateRequest = {\n  type: typeof MessageType.SaveCustomTemplate;\n  payload: {\n    template: Omit<PromptTemplate, 'type'>;\n    isNew: boolean;\n  };\n};\n\nexport type SaveCustomTemplateResponse = {\n  success: boolean;\n  template?: PromptTemplate;\n  error?: string;\n};\n\nexport type DeleteCustomTemplateRequest = {\n  type: typeof MessageType.DeleteCustomTemplate;\n  payload: {\n    templateId: string;\n  };\n};\n\nexport type DeleteCustomTemplateResponse = {\n  success: boolean;\n  error?: string;\n};\n\nexport type ImportTemplatesRequest = {\n  type: typeof MessageType.ImportTemplates;\n  payload: {\n    exportedData: ExportedTemplates;\n    conflictResolution: 'skip' | 'replace' | 'rename';\n  };\n};\n\nexport type ImportTemplatesResponse = {\n  success: boolean;\n  importedCount: number;\n  skippedCount: number;\n  errors?: string[];\n};\n\nexport type ExportTemplatesRequest = {\n  type: typeof MessageType.ExportTemplates;\n};\n\nexport type ExportTemplatesResponse = {\n  success: boolean;\n  exportedData?: ExportedTemplates;\n  error?: string;\n};\n\n// ============================================================\n// TYPE GUARDS FOR TEMPLATE MESSAGES\n// ============================================================\n\nexport function isGetTemplatesRequest(message: unknown): message is GetTemplatesRequest {\n  if (!message || typeof message !== 'object') return false;\n  return (message as GetTemplatesRequest).type === MessageType.GetTemplates;\n}\n\nexport function isSetSelectedTemplateRequest(message: unknown): message is SetSelectedTemplateRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as SetSelectedTemplateRequest;\n  return typed.type === MessageType.SetSelectedTemplate && typeof typed.payload?.templateId === 'string';\n}\n\nexport function isSaveCustomTemplateRequest(message: unknown): message is SaveCustomTemplateRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as SaveCustomTemplateRequest;\n  return typed.type === MessageType.SaveCustomTemplate && typeof typed.payload?.template === 'object';\n}\n\nexport function isDeleteCustomTemplateRequest(message: unknown): message is DeleteCustomTemplateRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as DeleteCustomTemplateRequest;\n  return typed.type === MessageType.DeleteCustomTemplate && typeof typed.payload?.templateId === 'string';\n}\n\nexport function isImportTemplatesRequest(message: unknown): message is ImportTemplatesRequest {\n  if (!message || typeof message !== 'object') return false;\n  const typed = message as ImportTemplatesRequest;\n  return typed.type === MessageType.ImportTemplates && typeof typed.payload?.exportedData === 'object';\n}\n\nexport function isExportTemplatesRequest(message: unknown): message is ExportTemplatesRequest {\n  if (!message || typeof message !== 'object') return false;\n  return (message as ExportTemplatesRequest).type === MessageType.ExportTemplates;\n}\n\n// Re-export template types for convenience\nexport type { PromptTemplate, ExportedTemplates } from './templates';\n", "import {\n  loadConfig,\n  loadAllTemplates,\n  loadCustomTemplates,\n  saveCustomTemplates,\n  getSelectedTemplateId,\n  setSelectedTemplateId,\n  addToRecentTemplates\n} from '../shared/config';\nimport { requestOptimizedPrompt } from '../shared/llm';\nimport {\n  isOptimizePromptRequest,\n  isGetTemplatesRequest,\n  isSetSelectedTemplateRequest,\n  isSaveCustomTemplateRequest,\n  isDeleteCustomTemplateRequest,\n  isImportTemplatesRequest,\n  isExportTemplatesRequest,\n  OptimizePromptResponse,\n  GetTemplatesResponse,\n  SetSelectedTemplateResponse,\n  SaveCustomTemplateResponse,\n  DeleteCustomTemplateResponse,\n  ImportTemplatesResponse,\n  ExportTemplatesResponse,\n  MessageType,\n  TriggerOptimizeMessage\n} from '../shared/messages';\nimport {\n  findTemplateById,\n  validateTemplate,\n  isPresetTemplate,\n  PRESET_TEMPLATES\n} from '../shared/templates';\nimport type { PromptTemplate, ExportedTemplates } from '../shared/templates';\n\n// Handle keyboard shortcut command\nchrome.commands.onCommand.addListener((command) => {\n  if (command === 'optimize-prompt') {\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n      if (tabs[0]?.id) {\n        const message: TriggerOptimizeMessage = { type: MessageType.TriggerOptimize };\n        chrome.tabs.sendMessage(tabs[0].id, message);\n      }\n    });\n  }\n});\n\nchrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\n  // Handle OptimizePrompt\n  if (isOptimizePromptRequest(message)) {\n    handleOptimize(message.payload)\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          error: error?.message || 'Unknown error'\n        } satisfies OptimizePromptResponse)\n      );\n    return true;\n  }\n\n  // Handle GetTemplates\n  if (isGetTemplatesRequest(message)) {\n    handleGetTemplates()\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          templates: [],\n          selectedTemplateId: 'general',\n          error: error?.message || 'Unknown error'\n        } satisfies GetTemplatesResponse)\n      );\n    return true;\n  }\n\n  // Handle SetSelectedTemplate\n  if (isSetSelectedTemplateRequest(message)) {\n    handleSetSelectedTemplate(message.payload.templateId)\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          error: error?.message || 'Unknown error'\n        } satisfies SetSelectedTemplateResponse)\n      );\n    return true;\n  }\n\n  // Handle SaveCustomTemplate\n  if (isSaveCustomTemplateRequest(message)) {\n    handleSaveCustomTemplate(message.payload.template, message.payload.isNew)\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          error: error?.message || 'Unknown error'\n        } satisfies SaveCustomTemplateResponse)\n      );\n    return true;\n  }\n\n  // Handle DeleteCustomTemplate\n  if (isDeleteCustomTemplateRequest(message)) {\n    handleDeleteCustomTemplate(message.payload.templateId)\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          error: error?.message || 'Unknown error'\n        } satisfies DeleteCustomTemplateResponse)\n      );\n    return true;\n  }\n\n  // Handle ImportTemplates\n  if (isImportTemplatesRequest(message)) {\n    handleImportTemplates(message.payload.exportedData, message.payload.conflictResolution)\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          importedCount: 0,\n          skippedCount: 0,\n          errors: [error?.message || 'Unknown error']\n        } satisfies ImportTemplatesResponse)\n      );\n    return true;\n  }\n\n  // Handle ExportTemplates\n  if (isExportTemplatesRequest(message)) {\n    handleExportTemplates()\n      .then(sendResponse)\n      .catch((error: Error) =>\n        sendResponse({\n          success: false,\n          error: error?.message || 'Unknown error'\n        } satisfies ExportTemplatesResponse)\n      );\n    return true;\n  }\n});\n\n// ============================================================\n// MESSAGE HANDLERS\n// ============================================================\n\nasync function handleOptimize(payload: {\n  originalPrompt: string;\n  templateId: string;\n  pageHost?: string;\n}): Promise<OptimizePromptResponse> {\n  const config = await loadConfig();\n  if (!config.apiKey) {\n    return { success: false, error: '\u8BF7\u5148\u5728 Options \u9875\u9762\u914D\u7F6E API Key' };\n  }\n\n  // Load templates and find the selected one\n  const templates = await loadAllTemplates();\n  const template = findTemplateById(templates, payload.templateId);\n\n  // Use template's system prompt instead of config's\n  const configWithTemplate = {\n    ...config,\n    systemPrompt: template.systemPrompt\n  };\n\n  // Track template usage\n  await addToRecentTemplates(payload.templateId);\n\n  const optimizedPrompt = await requestOptimizedPrompt(\n    configWithTemplate,\n    payload.originalPrompt,\n    payload.pageHost\n  );\n\n  return { success: true, optimizedPrompt };\n}\n\nasync function handleGetTemplates(): Promise<GetTemplatesResponse> {\n  const [templates, selectedTemplateId] = await Promise.all([\n    loadAllTemplates(),\n    getSelectedTemplateId()\n  ]);\n\n  return {\n    success: true,\n    templates,\n    selectedTemplateId\n  };\n}\n\nasync function handleSetSelectedTemplate(templateId: string): Promise<SetSelectedTemplateResponse> {\n  await setSelectedTemplateId(templateId);\n  return { success: true };\n}\n\nasync function handleSaveCustomTemplate(\n  templateData: Omit<PromptTemplate, 'type'>,\n  isNew: boolean\n): Promise<SaveCustomTemplateResponse> {\n  // Validate template\n  const validation = validateTemplate(templateData);\n  if (!validation.valid) {\n    return { success: false, error: validation.errors.join('; ') };\n  }\n\n  // Prevent saving with preset IDs\n  if (isPresetTemplate(templateData.id)) {\n    return { success: false, error: '\u4E0D\u80FD\u4F7F\u7528\u9884\u8BBE\u6A21\u677F\u7684 ID' };\n  }\n\n  const customTemplates = await loadCustomTemplates();\n  const existingIndex = customTemplates.findIndex(t => t.id === templateData.id);\n\n  const template: PromptTemplate = {\n    ...templateData,\n    type: 'custom',\n    createdAt: templateData.createdAt ?? Date.now()\n  };\n\n  if (isNew) {\n    if (existingIndex !== -1) {\n      return { success: false, error: '\u6A21\u677F ID \u5DF2\u5B58\u5728' };\n    }\n    customTemplates.push(template);\n  } else {\n    if (existingIndex === -1) {\n      return { success: false, error: '\u6A21\u677F\u4E0D\u5B58\u5728' };\n    }\n    customTemplates[existingIndex] = template;\n  }\n\n  await saveCustomTemplates(customTemplates);\n  return { success: true, template };\n}\n\nasync function handleDeleteCustomTemplate(templateId: string): Promise<DeleteCustomTemplateResponse> {\n  // Cannot delete preset templates\n  if (isPresetTemplate(templateId)) {\n    return { success: false, error: '\u65E0\u6CD5\u5220\u9664\u9884\u8BBE\u6A21\u677F' };\n  }\n\n  const customTemplates = await loadCustomTemplates();\n  const filteredTemplates = customTemplates.filter(t => t.id !== templateId);\n\n  if (filteredTemplates.length === customTemplates.length) {\n    return { success: false, error: '\u6A21\u677F\u4E0D\u5B58\u5728' };\n  }\n\n  await saveCustomTemplates(filteredTemplates);\n\n  // If deleted template was selected, reset to general\n  const selectedId = await getSelectedTemplateId();\n  if (selectedId === templateId) {\n    await setSelectedTemplateId('general');\n  }\n\n  return { success: true };\n}\n\nasync function handleImportTemplates(\n  exportedData: ExportedTemplates,\n  conflictResolution: 'skip' | 'replace' | 'rename'\n): Promise<ImportTemplatesResponse> {\n  // Validate export format\n  if (exportedData.version !== '1.0') {\n    return {\n      success: false,\n      importedCount: 0,\n      skippedCount: 0,\n      errors: ['\u4E0D\u652F\u6301\u7684\u5BFC\u51FA\u6587\u4EF6\u7248\u672C']\n    };\n  }\n\n  if (!Array.isArray(exportedData.templates)) {\n    return {\n      success: false,\n      importedCount: 0,\n      skippedCount: 0,\n      errors: ['\u65E0\u6548\u7684\u6A21\u677F\u6570\u636E\u683C\u5F0F']\n    };\n  }\n\n  const customTemplates = await loadCustomTemplates();\n  const existingIds = new Set([\n    ...customTemplates.map(t => t.id),\n    ...PRESET_TEMPLATES.map(t => t.id)\n  ]);\n\n  let importedCount = 0;\n  let skippedCount = 0;\n  const errors: string[] = [];\n\n  for (const template of exportedData.templates) {\n    // Validate each template\n    const validation = validateTemplate(template);\n    if (!validation.valid) {\n      errors.push(`\u6A21\u677F \"${template.name}\": ${validation.errors.join('; ')}`);\n      skippedCount++;\n      continue;\n    }\n\n    // Handle conflicts\n    if (existingIds.has(template.id)) {\n      if (conflictResolution === 'skip') {\n        skippedCount++;\n        continue;\n      } else if (conflictResolution === 'rename') {\n        // Generate new ID\n        template.id = crypto.randomUUID();\n      } else if (conflictResolution === 'replace') {\n        // Remove existing\n        const existingIndex = customTemplates.findIndex(t => t.id === template.id);\n        if (existingIndex !== -1) {\n          customTemplates.splice(existingIndex, 1);\n        }\n      }\n    }\n\n    // Add template\n    customTemplates.push({\n      ...template,\n      type: 'custom',\n      createdAt: template.createdAt ?? Date.now()\n    });\n    existingIds.add(template.id);\n    importedCount++;\n  }\n\n  await saveCustomTemplates(customTemplates);\n\n  return {\n    success: true,\n    importedCount,\n    skippedCount,\n    errors: errors.length > 0 ? errors : undefined\n  };\n}\n\nasync function handleExportTemplates(): Promise<ExportTemplatesResponse> {\n  const customTemplates = await loadCustomTemplates();\n\n  const exportedData: ExportedTemplates = {\n    version: '1.0',\n    exportedAt: new Date().toISOString(),\n    templates: customTemplates\n  };\n\n  return {\n    success: true,\n    exportedData\n  };\n}\n"],
  "mappings": "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",
  "names": []
}
